<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HelthBooster -project code: moral-riddle-2098, owner: Rushikesh Bhomale</title>
    <link rel="icon" href="./titleLogo.jpg" type="image/icon type">
    <meta charset="UTF-8">
    <meta property="og:title" content="HelathBooster.com">
    <!-- <style>
        body {
            box-sizing: border-box;
        }

        img {
            width: 100%;
            margin: auto;
            height: 200px;
        }

        #outer {
            width: 90%;
            margin: auto;
            box-sizing: border-box;
        }

        #main {
            width: 100%;
            /* margin: auto; */
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px 20px;
            box-shadow: rgba(100, 100, 111, 0.2) 0px 7px 29px 0px;
        }

        #outer {
            margin-top: 20px;
        }

        #container .card-list {
            width: 95%;
            margin: auto;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px 30px;
            margin-top: 30px;
        }

        .card {
            width: 100%;
            height: 420px;
            margin: auto;
            padding: 5px;
            background-color: FFFEFF;
            box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
            border-radius: 10px;
        }

        .card_addCart,
        .card_addWishlist {
            width: 40%;
            margin: 7px;
            padding: 7px;
            font-size: 12px;
            border-radius: 15px;
            background-color: whitesmoke;
        }

        #pagination {
            width: 30%;
            margin: auto;
            display: flex;
            flex-direction: row;
            margin-top: 20px;
        }

        #pagination>button {
            margin: 10px;
            font-size: 17px;
            font-weight: bold;
            background-color: #498c4d;
            color: white;
            border-radius: 8px;
            padding: 8px;
        } 
    </style>-->
    <script src="https://kit.fontawesome.com/c4254e24a8.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="./cart.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<style>
    #cart{
        text-align: center;
        font-size: 20px;
        margin: 7px;
        font-weight: bold;
        background-color: rgb(174, 238, 168);
    }
</style>

<body>

    <!-- NAVBAR -->

    <!-- <div id="discount">GET RS 50 OFF ON ORDERS ABOVE RS 100</div> -->
    <nav class="navbar">
        <div class="top-nav">
            <div class="logo">
                <a href="./index.html"><img src="./logo.jpg" alt=""></a>
            </div>
            <div class="search-bar">
                <div class="title">SEARCH</div>
                <input type="search" name="" id="search" placeholder="Search here for products">
                <div class="search-icon">
                    <i class="fa fa-search" id="search-btn"></i>
                </div>
            </div>
            <div class="nav-buttons">
                <div id="signup-div">
                    <a href="./signup.html" id="sign-in"><i class="fa fa-user"></i> Sign In / Register</a>
                </div>
                <a class="wish" href="./wishlist.html">
                    <h4 id="wishlistCounter">0</h4> <i class="fa-regular fa-heart"></i> Wishlist
                  </a>
                  <a class="wish" href="./Cart.html">
                    <h4 id="cartCounter">0</h4> <i class="fa-solid fa-cart-shopping"></i>Cart
                  </a>
            </div>
        </div>
        <div class="bottom-nav">
            <a href="">Brands</a>
            <a href="./product.html">All Products</a>
            <a href="">Blogs</a>
            <a href="">gift Card</a>
            <a href="">Coustomer Support</a>
            <a href="">Store Location</a>
        </div>
        <div id="cart">Your Cart</div>
        <div class="placeOrder-nav">
            <h3>0</h3>
            <a href="">Click Here to Place Order</a>
        </div>
    </nav>

    <!-- NAVBAR -->
    <div id="outer">
        <div id="container">
            <!-- product appende here -->
        </div>
        <div id="pagination">
            <!-- pagination here -->
        </div>
    </div>

    <div id="f-main">
        <footer>
            <div class="f-cont">
                <div class="f-row">
                    <div class="col" id="about">
                        <h3>About Us</h3>
                        <p>HelathBooster was established in May 2023. This company started with a few employees but
                            transitioned
                            into
                            a full-fledged online platform within just a few months. By June 2023, HelathBooster
                            introduced the
                            certified,
                            well-known Indian and international brands to its platform, and that is increasing in number
                            each passing
                            month.</p>
                        <div class="s-media">
                            <a href="#"><i class="fa fa-facebook"></i></a>
                            <a href="#"><i class="fa fa-instagram"></i></a>
                            <a href="#"><i class="fa fa-twitter"></i></a>
                            <a href="#"><i class="fa fa-github"></i></a>
                        </div>
                    </div>
                    <div class="col" id="company">
                        <h3>TOP BRANDS</h3>
                        <div class="link">
                            <a href="/">HealthKart</a>
                            <a href="#">MuscleBlaze</a>
                            <a href="#">BPI</a>
                            <a href="#">True Basic</a>
                            <a href="#">Onetouch</a>
                            <a href="#">Dr.Morepen</a>
                            <a href="#">Beurer</a>
                        </div>
                    </div>
                    <div class="col" id="category">
                        <h3>TOP CATEGORIES</h3>
                        <div class="link">
                            <a href="#">Biotin</a>
                            <a href="#">Fitness</a>
                            <a href="#">Whey Proteins</a>
                            <a href="#">Mass Gainer</a>
                            <a href="#">Vitals</a>
                            <a href="#">Instrument</a>
                        </div>
                    </div>
                    <div class="col" id="policy">
                        <h3>POLICIES & INFO</h3>
                        <div class="link">
                            <a href="">Privacy Policy</a>
                            <a href="">SUPPORT</a>
                            <a href="">For Help, email to care@healthbooster.com</a>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- FOOTER -->
</body>

</html>
<script>

    // session storage for token
    var saveToken = JSON.parse(sessionStorage.getItem("token"));
    var wishlistCounter = document.getElementById("wishlistCounter");
    var cartCounter = document.getElementById("cartCounter");
    // console.log(cartCounter);

    // getting wishlist and cart length by this functions
    fetchCartLength(), fetchWishlistLength();


    function fetchCartLength() {
        // console.log("HIII");
        fetch(`http://localhost:4500/cart/`, {
            method: "GET",
            headers: {
                "authorization": `Bearer ${saveToken.token}`
            }
        })
            .then((res) => res.json()).then((res) => {
                console.log(res.cart);
                let length = res.cart.length;
                cartCounter.innerText = length;
            }).catch((err) => {
                console.log(err);
            })
    };


    function fetchWishlistLength() {
        // console.log("HIII");
        fetch(`http://localhost:4500/wishlist/`, {
            method: "GET",
            headers: {
                "authorization": `Bearer ${saveToken.token}`
            }
        })
            .then((res) => res.json()).then((res) => {
                console.log(res.wishlist);
                let length = res.wishlist.length;
                wishlistCounter.innerText = length;
            }).catch((err) => {
                console.log(err);
            })
    };

    window.addEventListener("load",()=>{
        fetchData();
    })

  function fetchData(){
    fetch(`http://localhost:4500/cart/`, {
        method: "GET",
        headers: {
            "authorization": `Bearer ${saveToken.token}`
        }
    }).then((res) => res.json()).then((res) => {
        console.log(res.wishlist)
        getCardList(res.cart)
    }).catch((err) => console.log(err));
    }

    let container = document.getElementById("container");
    // getCardList(product)
    function getCardList(data) {
        let brand = {};
        let category = {};
        container.innerHTML = null;
        let cardList = document.createElement("div");
        cardList.classList = "card-list";
        container.append(cardList);
        // console.log(data);
        data.forEach((element) => {
            if (brand[element.brand] == undefined) {
                brand[element.brand] = 1;
            } else {
                brand[element.brand]++;
            }
            if (category[element.category] == undefined) {
                category[element.category] = 1;
            } else {
                category[element.category]++;
            }
            let card = getCard(element._id, element.title, element.brand, element.category, element.rating, element.price, element.img, element.quantity);
            cardList.append(card)
        });
        console.log("Brand", brand);
        console.log("category", category);
        return cardList;
    }
    function getCard(dataId, title, brand, category, rating, price, avatar, quantity) {
        // console.log({dataId:dataId, title:title, brand:brand, category:category, rating:rating, price:price, avatar:avatar, quantity:quantity});
        let card = document.createElement("div");
        card.classList = "card";
        card.setAttribute("data-id", dataId);
        // card.innerText=username;

        let imageCard = document.createElement("div");
        imageCard.classList = "card_img";

        let image = document.createElement("img");
        // console.log(avatar);
        image.src = avatar;
        image.setAttribute("alt", `${title} image`);

        let cardBody = document.createElement("div");
        cardBody.classList = "card_body";

        let nameCard = document.createElement("h4");
        nameCard.classList = "card_item";
        nameCard.classList = "card_title";
        nameCard.innerText = `${title}`;

        // let brandCard = document.createElement("h4");
        // brandCard.classList = "card_item"
        // brandCard.classList = "card_description";
        // brandCard.innerHTML = `Brand:${brand} Catgory: ${category}`;

        // let categoryCard = document.createElement("div");
        // categoryCard.classList = "card_item"
        // categoryCard.classList = "card_description";
        // categoryCard.innerText = category;

        let ratingCard = document.createElement("h4");
        ratingCard.classList = "card_item"
        ratingCard.classList = "card_rating";
        ratingCard.innerHTML = `<i class="fa-sharp fa-solid fa-star" style="color: #212121;"></i> ${rating}`
        // `Rating: ${rating}  Price: ${price}`;

        let priceCard = document.createElement("h4");
        priceCard.classList = "card_item"
        priceCard.classList = "card_price";
        priceCard.innerText = `₹ ${price}`;

        let buttonDiv = document.createElement("div");
        buttonDiv.classList = "card_button";

        let cartButton = document.createElement("button");
        cartButton.classList = "card_item";
        cartButton.classList = "card_addCart";
        cartButton.id = dataId

        cartButton.innerHTML = `<i class="fa-solid fa-cart-shopping fa-bounce"></i> Add To Cart`
        cartButton.addEventListener("click", (e) => {
            let cartObject = {
                "title": title,
                "brand": brand,
                "category": category,
                "rating": rating,
                "price": price,
                "img": avatar,
                "quantity": 1,
                "prodID": e.target.id
            };
            // console.log(cartObject);
            // console.log(saveToken.token);
            fetch(`http://localhost:4500/wishlist/${e.target.id}`, {
                method: "DELETE",
                headers: {
                    'Content-type': "application/json"
                }
            }).then((res) => res.json()).then((res) => console.log(res)).catch((err) => console.log(err))
            fetch(`http://localhost:4500/cart/add/`, {
                method: "POST",
                headers: {
                    'Content-type': "application/json",
                    "authorization": `Bearer ${saveToken.token}`
                },
                body: JSON.stringify(cartObject)
            }).then((res) => res.json()).then((res) => {
                console.log(res);
                fetchData();
            })
        })
        let removeButton = document.createElement("button");
        removeButton.classList = "card_item";
        removeButton.classList = "card_addWishlist";
        removeButton.id = dataId
        removeButton.innerHTML = `Remove`
        removeButton.addEventListener("click", (e) => {
            let removeObject = {
                "title": title,
                "brand": brand,
                "category": category,
                "rating": rating,
                "price": price,
                "img": avatar,
                "quantity": 1
            };
            // console.log(wishlistObject);
            // console.log(saveToken.token);
            // fetch(`http://localhost:4500/products/updateAfterAddCart/${e.target.id}`,{
            //     method:"PATCH",
            //     headers:{
            //         'Content-type':"application/json"
            //     },
            //     body:JSON.stringify({quantity:quantity-1})
            // }).then((res)=>res.json()).then((res)=>console.log(res)).catch((err)=>console.log(err))
            fetch(`http://localhost:4500/wishlist/add/`, {
                method: "POST",
                headers: {
                    'Content-type': "application/json",
                    "authorization": `Bearer ${saveToken.token}`
                },
                body: JSON.stringify(removeObject)
            }).then((res) => res.json()).then((res) => {
                console.log(res);
                fetchData()
            })
        })
        buttonDiv.append(cartButton, removeButton)

        //     let quantityCard = document.createElement("h5");
        //     quantityCard.classList = "card_item"
        //     quantityCard.classList = "card_quantity";
        //     quantityCard.innerText = `Out Of Stock`;
        //     // quantityCard.innerHTML = `2`

        cardBody.append(ratingCard, nameCard, priceCard, buttonDiv)

        imageCard.append(image)

        card.append(imageCard, cardBody)

        return card;
    };
</script>